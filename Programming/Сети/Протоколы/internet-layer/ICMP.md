---
создал заметку: 2024-07-23
tags:
  - network
  - protocols
  - internetlayer
---
### Описание

**ICMP (Internet Control Message Protocol)** — это протокол межсетевых управляющих сообщений, используемый для передачи сообщений об ошибках и другой контрольной информации между устройствами в сети.

#### Основные функции ICMP:
- **Сообщения об ошибках**:
    - **Получатель недоступен**: Уведомляет отправителя о невозможности доставить пакет.
    - **Закончился TTL (Time To Live)**: Информирует, что пакет был уничтожен, так как превысил максимальное количество переходов (hops).
    - **Запрещено фрагментировать пакет**: Уведомляет, что пакет слишком велик для передачи без фрагментации, но фрагментация запрещена.
- **Тестирование работы сети**:
    - **ping**: Проверяет доступность узла, отправляя эхо-запрос и ожидая эхо-ответ.
    - **traceroute**: Определяет маршрут до узла, фиксируя все промежуточные устройства (маршрутизаторы) по пути.

_Обработка сообщений об ошибках ICMP не является обязательной для всех устройств._

#### Формат заголовка ICMP

![](https://i.imgur.com/PYm7osf.png)

#### Типы ICMP-сообщений:

|Тип|Назначение сообщения|
|---|---|
|0|Эхо-ответ|
|3|Узел назначения недостижим|
|5|Перенаправления маршрута|
|8|Эхо-запрос|
|9|Сообщение о маршрутизаторе|
|10|Запрос сообщения о маршрутизаторе|
|11|Истечение времени жизни пакета|
|12|Проблемы с параметрами|
|13|Запрос отметки времени|
|14|Ответ отметки времени|

#### Коды ICMP-сообщений (для типа 3 — Узел назначения недостижим):

|Код|Причина|
|---|---|
|0|Сеть недостижима|
|1|Узел недостижим|
|2|Протокол недостижим|
|3|Порт недостижим|
|4|Ошибка фрагментации|
|5|Ошибка в маршруте источника|
|6|Сеть назначения неизвестна|
|7|Узел назначения неизвестен|
|8|Узел-источник изолирован|
|9|Административный запрет|

#### Утилита ping
- Проверяет доступность устройства в сети.
- Использует эхо-протокол ICMP:
    - Эхо-запрос ICMP (Тип = 8, Код = 0)
    - Эхо-ответ ICMP (Тип = 0, Код = 0)
![](https://i.imgur.com/1USgQ7d.gif)
#### Утилита traceroute
- `traceroute` определяет маршрут от отправителя к получателю.
- Определяет IP-адреса всех промежуточных маршрутизаторов.
![](https://i.imgur.com/8rXHcTn.gif)
### Краткое содержание

**ICMP (Internet Control Message Protocol)** — это протокол, используемый для передачи сообщений об ошибках и тестирования работы сети. Он играет ключевую роль в диагностике и управлении сетями. ^a1b340